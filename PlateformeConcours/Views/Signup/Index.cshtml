
@{
    ViewBag.Title = "S'inscrire";
    Layout = "~/Views/Shared/_Layout.cshtml";

}
@using PlateformeConcours.helpers
@model PlateformeConcours.ViewModel.SignupViewModel

<div class="intro-section" id="home-section">
    <div class="slide-1"
         style="background-image: url('images/hero_1.jpg');"
         data-stellar-background-ratio="0.5">
        <div class="container-fluid">

            <div class="row align-items-center">
                <div class="col-12">
                    <div class="row  align-items-center justify-content-center m-5">
                        <div class="col-12 col-md-12 col-lg-12 ml-auto mt-5 " data-aos="fade-up" data-aos-delay="400">
                            <!--Signin form-->

                            @using (Html.BeginForm("edit", "Signup", FormMethod.Post, new { @class = "form-box border border-dark", id = "regForm", enctype = "multipart/form-data" }))
                            {

                                if (Model.isError)
                                {
                                    <div class="alert alert-danger" role="alert">
                                        @Model.message
                                    </div>
                                }
                                else if (Model.isError)
                                {
                                    <div class="alert alert-success" role="alert">
                                        @Model.message
                                    </div>
                                }
                                else if (ViewBag.Message == "error")
                                {
                                    <div class="alert alert-danger"><strong>Vous Etes deja Inscrit !</strong> Veuillez contacter le service de scolarite .</div>
                                }
                                @Html.AntiForgeryToken()
                                <div class="form-horizontal mt-1 tab">
                                    <h3 class="h4 text-black text-center">Informations personelles</h3>
                                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                                    @Html.HiddenFor(model => model.etudiant.ID)
                                    <div class="container-fluid">
                                        <div class="row">
                                            <div class="col-6">
                                                <div class="form-group">
                                                    <div class="col-md-8 m-auto">
                                                        @Html.EditorFor(model => model.etudiant.Nom, new { htmlAttributes = new { @class = "form-control", placeholder = "Nom" } })
                                                        <label style="display:none;" class="text-danger" id="input0"></label>
                                                        @Html.ValidationMessageFor(model => model.etudiant.Nom, "", new { @class = "text-danger" })
                                                    </div>
                                                </div>

                                                <div class="form-group">
                                                    <div class="col-md-8 m-auto">
                                                        @Html.EditorFor(model => model.etudiant.Prenom, new { htmlAttributes = new { @class = "form-control", placeholder = "Prenom", id = "prenom" } })
                                                        <label style="display:none;" class="text-danger" id="input1"></label>
                                                        @Html.ValidationMessageFor(model => model.etudiant.Prenom, "", new { @class = "text-danger" })
                                                    </div>
                                                </div>

                                                <div class="form-group">
                                                    <div class="col-md-8 m-auto">
                                                        @Html.EditorFor(model => model.etudiant.Cne, new { htmlAttributes = new { @class = "form-control", placeholder = "Cne" } })
                                                        @Html.ValidationMessageFor(model => model.etudiant.Cne, "", new { @class = "text-danger" })
                                                        <label style="display:none;" class="text-danger" id="input2"></label>
                                                    </div>
                                                </div>

                                                <div class="form-group">
                                                    <div class="col-md-8 m-auto">
                                                        @Html.EditorFor(model => model.etudiant.Cin, new { htmlAttributes = new { @class = "form-control", placeholder = "Cin" } })
                                                        @Html.ValidationMessageFor(model => model.etudiant.Cin, "", new { @class = "text-danger" })
                                                        <label style="display:none;" class="text-danger" id="input3"></label>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="col-md-8 m-auto">
                                                        @Html.EditorFor(model => model.etudiant.Email, new { htmlAttributes = new { @class = "form-control", placeholder = "Email", id = "email" } })
                                                        @Html.ValidationMessageFor(model => model.etudiant.Email, "", new { @class = "text-danger" })
                                                        <label style="display:none;" class="text-danger" id="input4"></label>
                                                    </div>
                                                </div>

                                            </div>
                                            <div class="col-6">
                                                <div class="form-group">
                                                    <div class="col-md-8 m-auto">
                                                        <div class="input-group mb-3">
                                                            <div class="input-group-prepend">
                                                                <label class="input-group-text" for="inputGroupSelect01">Civilité</label>
                                                            </div>
                                                            @Html.DropDownList("civilite", new List<SelectListItem>
                                                            {
                                                                new SelectListItem{Text="Mr.",Value="Mr.",Selected=true},
                                                                new SelectListItem{Text="Mme",Value="Mme",Selected=true}
                                                            }, new { @class = "custom-select" })
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="form-group">
                                                    <div class="col-md-8 m-auto">
                                                        @Html.EditorFor(model => model.etudiant.Tel, new { htmlAttributes = new { @class = "form-control", Type = "number", placeholder = "Numero de Telephone" } })
                                                        @Html.ValidationMessageFor(model => model.etudiant.Tel, "", new { @class = "text-danger" })
                                                        <label style="display:none;" class="text-danger" id="input5"></label>
                                                    </div>
                                                </div>

                                                <div class="form-group">
                                                    <div class="col-md-8 m-auto">
                                                        @Html.EditorFor(model => model.etudiant.DateNaiss, new { htmlAttributes = new { @class = "form-control", Type = "date" } })
                                                        @Html.ValidationMessageFor(model => model.etudiant.DateNaiss, "", new { @class = "text-danger" })
                                                        <label style="display:none;" class="text-danger" id="input6"></label>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="col-md-8 m-auto">
                                                        <div class="input-group mb-3">
                                                            <div class="input-group-prepend">
                                                                <label class="input-group-text" for="inputGroupSelect01">Photo </label>
                                                            </div>
                                                            <input required name="picture" class="custom-select" id="picture" type="file" accept=".png,.jpeg,.jpg">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="col-md-8 m-auto">
                                                        <div class="input-group mb-3">
                                                            <div class="input-group-prepend">
                                                                <label class="input-group-text" for="inputGroupSelect01">Nationalité</label>
                                                            </div>
                                                            @Html.DropDownList("nationalite", Model.selectC as SelectList, "selectionner votre pays", new { @class = "custom-select", id = "inputGroupSelect01" })
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-horizontal mt-1 tab">
                                    <h3 class="h4 text-black text-center">Choix de filiéres </h3>
                                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                                    <div class="container-fluid">
                                        <div class="row">
                                            <div class="col-6 m-auto">
                                                <div class="form-group">
                                                    <div class="col-md-8 m-auto">
                                                        <div class="input-group mb-3">
                                                            <div class="input-group-prepend">
                                                                <label class="input-group-text" for="inputGroupSelect01">Filiére</label>
                                                            </div>
                                                            @Html.DropDownList("filiere", Model.selectF as SelectList, "selectionner une filiere", new { @class = "custom-select", id = "inputGroupSelect01", required = "required" })
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-horizontal mt-1 tab">
                                    <h3 class="h4 text-black text-center">Relevée de notes et Diplomes</h3>
                                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                                    <div class="container-fluid">
                                        <div class="row">
                                            <div class="col-6">
                                                <div class="form-group">
                                                    <div class="col-md-10 m-auto">
                                                        <div class="input-group mb-3">
                                                            <div class="input-group-prepend">
                                                                <label class="input-group-text" for="inputGroupSelect01">Votre choix d'année CI</label>
                                                            </div>
                                                            @Html.DropDownList("Choixdannee", new List<SelectListItem>
                                                            {
                                                                new SelectListItem{Text="3éme année",Value="3eme"},
                                                                new SelectListItem{Text="4éme année",Value="4eme",Selected=true}
                                                            }, new { @class = "custom-select", id = "choixdannee" })

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="form-group">
                                                    <div class="col-md-10 m-auto">
                                                        <div class="input-group mb-3">
                                                            <div class="input-group-prepend">
                                                                <label class="input-group-text" for="inputGroupSelect01">Type de diplôme</label>
                                                            </div>
                                                            <select required name="etudiant.Diplome.Titre" class="custom-select" id="type-diplome">
                                                                <option value="LP">LP</option>
                                                                <option value="LF">LF</option>
                                                                <option value="LST">LST</option>
                                                            </select>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-6">
                                                <div class="form-group">
                                                    <div class="col-md-10 m-auto">
                                                        <div class="input-group mb-3">
                                                            <div class="input-group-prepend">
                                                                <label class="input-group-text" for="inputGroupSelect01">Extrait de diplôme</label>
                                                            </div>
                                                            <input required name="fichier" class="custom-select" id="fichier" type="file" accept=".pdf">


                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="border-top my-3"></div>
                                        <div class="row">
                                            <div class="col-6">
                                                @* Etablissement *@
                                                <div class="form-group">
                                                    <div class="col-md-8 m-auto">
                                                        @Html.EditorFor(model => model.etudiant.Diplome.Etablissement, new { htmlAttributes = new { @class = "form-control", placeholder = "Etablissement" } })
                                                        @Html.ValidationMessageFor(model => model.etudiant.Diplome.Etablissement, "", new { @class = "text-danger" })

                                                    </div>
                                                </div>
                                                @* Ville *@
                                                <div class="form-group">
                                                    <div class="col-md-8 m-auto">
                                                        @Html.EditorFor(model => model.etudiant.Diplome.Ville, new { htmlAttributes = new { @class = "form-control", placeholder = "Ville" } })
                                                        @Html.ValidationMessageFor(model => model.etudiant.Diplome.Ville, "", new { @class = "text-danger" })
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                @* Note Bac *@
                                                <div class="form-group">
                                                    <div class="col-md-8 m-auto">
                                                        @Html.EditorFor(model => model.etudiant.Note.NoteBac, new { htmlAttributes = new { @class = "form-control", type = "number", placeholder = "Note Bac" } })
                                                        @Html.ValidationMessageFor(model => model.etudiant.Note.NoteBac, "", new { @class = "text-danger" })
                                                        <label style="display:none;" class="text-danger" id="input7"></label>
                                                    </div>
                                                </div>
                                                @* Annee Bac *@
                                                <div class="form-group">
                                                    <div class="col-md-8 m-auto">
                                                        @Html.EditorFor(model => model.etudiant.Diplome.AnneeBac, new { htmlAttributes = new { @class = "form-control", type = "number", placeholder = "Date d'obtention du bac" } })
                                                        @Html.ValidationMessageFor(model => model.etudiant.Diplome.AnneeBac, "", new { @class = "text-danger" })

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <table class="table table-striped table-responsive-sm btn-table">

                                            <thead>
                                                <tr>
                                                    <th>Annee</th>
                                                    <th>Redoublement</th>
                                                    <th style="text-align:center">Note Semestre</th>
                                                </tr>
                                            </thead>

                                            <tbody>
                                                <tr>
                                                    <td>
                                                        @Html.EditorFor(model => model.etudiant.Diplome.Annee1, new { htmlAttributes = new { @class = "form-control", type = "number", placeholder = "Annee1" } })
                                                        @Html.ValidationMessageFor(model => model.etudiant.Diplome.Annee1, "", new { @class = "text-danger" })
                                                    </td>
                                                    <td>
                                                        <div class="form-group text-center">
                                                            <div class="col-md-12 m-auto">
                                                                <label class="radio-inline">
                                                                    Oui @Html.RadioButtonFor(model => model.etudiant.Note.Redoublant1, true)
                                                                </label>
                                                                <label class="radio-inline">
                                                                    Non @Html.RadioButtonFor(model => model.etudiant.Note.Redoublant1, false)
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="row">
                                                            <div class="col-md-6 m-auto">
                                                                @Html.EditorFor(model => model.etudiant.Note.S1, new { htmlAttributes = new { @class = "form-control", type = "number", placeholder = "Note S1" } })
                                                                @Html.ValidationMessageFor(model => model.etudiant.Note.S1, "", new { @class = "text-danger" })
                                                                <label style="display:none;" class="text-danger" id="input8"></label>
                                                            </div>
                                                            <div class="col-md-6 m-auto">
                                                                @Html.EditorFor(model => model.etudiant.Note.S2, new { htmlAttributes = new { @class = "form-control", type = "number", placeholder = "Note S2" } })
                                                                @Html.ValidationMessageFor(model => model.etudiant.Note.S2, "", new { @class = "text-danger" })
                                                                <label style="display:none;" class="text-danger" id="input9"></label>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        @Html.EditorFor(model => model.etudiant.Diplome.Annee2, new { htmlAttributes = new { @class = "form-control", type = "number", placeholder = "Annee2" } })
                                                        @Html.ValidationMessageFor(model => model.etudiant.Diplome.Annee2, "", new { @class = "text-danger" })
                                                    </td>
                                                    <td>
                                                        <div class="form-group text-center">
                                                            <div class="col-md-12 m-auto">
                                                                <label class="radio-inline">
                                                                    Oui @Html.RadioButtonFor(model => model.etudiant.Note.Redoublant2, true)
                                                                </label>
                                                                <label class="radio-inline">
                                                                    Non @Html.RadioButtonFor(model => model.etudiant.Note.Redoublant2, false)
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="row">
                                                            <div class="col-md-6 m-auto">
                                                                @Html.EditorFor(model => model.etudiant.Note.S3, new { htmlAttributes = new { @class = "form-control", type = "number", placeholder = "Note S3" } })
                                                                @Html.ValidationMessageFor(model => model.etudiant.Note.S3, "", new { @class = "text-danger" })
                                                                <label style="display:none;" class="text-danger" id="input10"></label>
                                                            </div>
                                                            <div class="col-md-6 m-auto">
                                                                @Html.EditorFor(model => model.etudiant.Note.S4, new { htmlAttributes = new { @class = "form-control", type = "number", placeholder = "Note S4" } })
                                                                @Html.ValidationMessageFor(model => model.etudiant.Note.S4, "", new { @class = "text-danger" })
                                                                <label style="display:none;" class="text-danger" id="input11"></label>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <tr id="row_ann3">
                                                    <td>
                                                        @Html.EditorFor(model => model.etudiant.Diplome.Annee3, new { htmlAttributes = new { @class = "form-control", type = "number", placeholder = "Annee3" } })
                                                        @Html.ValidationMessageFor(model => model.etudiant.Diplome.Annee3, "", new { @class = "text-danger" })
                                                    </td>
                                                    <td>
                                                        <div class="form-group text-center" id="redoublant3">
                                                            <div class="col-md-12 m-auto">
                                                                <label class="radio-inline">
                                                                    Oui @Html.RadioButtonFor(model => model.etudiant.Note.Redoublant3, true)
                                                                </label>
                                                                <label class="radio-inline">
                                                                    Non @Html.RadioButtonFor(model => model.etudiant.Note.Redoublant3, false)
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="row">
                                                            <div class="col-md-6 m-auto" id="s5Form">
                                                                @Html.EditorFor(model => model.etudiant.Note.S5, new { htmlAttributes = new { @class = "form-control", type = "number", placeholder = "Note S5", id = "s5" } })
                                                                @Html.ValidationMessageFor(model => model.etudiant.Note.S5, "", new { @class = "text-danger" })
                                                                <label style="display:none;" class="text-danger" id="input12"></label>
                                                            </div>
                                                            <div class="col-md-6 m-auto" id="s6Form">
                                                                @Html.EditorFor(model => model.etudiant.Note.S6, new { htmlAttributes = new { @class = "form-control", type = "number", placeholder = "Note S6", id = "s6" } })
                                                                @Html.ValidationMessageFor(model => model.etudiant.Note.S6, "", new { @class = "text-danger" })
                                                                <label style="display:none;" class="text-danger" id="input13"></label>
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </tbody>

                                        </table>

                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12">
                                        <!-- Circles which indicates the steps of the form: -->
                                        <div style="text-align:center;">
                                            <span class="step"></span>
                                            <span class="step"></span>
                                            <span class="step"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12">
                                        <div class="form-group text-center">
                                            <div class="col-md-offset-2 col-md-12">
                                                <button type="button" id="prevBtn" onclick="nextPrev(-1)" class="btn btn-primary btn-pill"
                                                        title="Previous">
                                                    Previous
                                                    <span class="fa fa-arrow-left"></span> <!--  this is the icon  -->
                                                </button>
                                                <button type="button" id="nextBtn" onclick="nextPrev(1)" class="btn btn-primary btn-pill"
                                                        title="next">
                                                    Next
                                                    <span class="fa fa-arrow-right"></span> <!--  this is the icon  -->
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous"></script>
<script type="text/javascript" src="~/Scripts/jquery-3.3.1.js"></script>
<script type="text/javascript" src="~/Scripts/jquery.unobtrusive-ajax.js"></script>
<script>
    $(function () {
        $("#email").change(function () {
            $.get("/Signup/emailExists", { email: $("#email").val() },
                function (data) {
                    console.log(data);
                    console.log(data === true);
                    if (data === true) {
                        document.getElementById("input4").innerText = "un etudiant avec cet email est déja inscris!";
                        document.getElementById("input4").style.display = "inline";
                        $("#nextBtn").prop('disabled', 'disabled');

                    } else {
                        document.getElementById("input4").innerText = "";
                        document.getElementById("input4").style.display = "inline";
                        $("#nextBtn").prop('disabled', false);

                    }
                });
        });

    });
</script>
<script type="text/javascript">
    $(document).ready(function () { //newly added
        $('#Submit').click(function () {

        });
    });
</script>
<script>
    /* $("#show").click(function () {
         if ($("#Password").get(0).type == "text") {
             $("#Password").get(0).type = "password";
         } else {
             $("#Password").get(0).type = "text";
         }
     });*/
    var s5 = $('#s5'); //storing the value in dom
    var s6 = $('#s6'); //storing the value in dom

    $('prenom').on('input', function () {
        $('prenom').addClass("primary");
    });
    $("#choixdannee").change(function () {
        if ($(this).val() === '3eme') { // or this.value == 'volvo'
            $("#row_ann3").hide();


            let options = []


            $("#type-diplome")[0].innerHTML = `<option value="DUT">DUT</option>
                                                                <option value="DEUG">DEUG</option>
                                                                <option value="DEUST">DEUST</option>`;
            //$("#s6").prop('disabled', 'disabled');
        } else {
            $("#row_ann3").show();
            $("#type-diplome")[0].innerHTML = `<option value="LP">LP</option>
                                                                <option value="LF">LF</option>
                                                                <option value="LST">LST</option>`;

        }
    })
    var currentTab = 0; // Current tab is set to be the first tab (0)
    showTab(currentTab); // Display the current tab

    function showTab(n) {
        console.log("showTab");

        console.log(n);
        // This function will display the specified tab of the form ...
        var x = document.getElementsByClassName("tab");
        x[n].style.display = "block";
        // ... and fix the Previous/Next buttons:
        if (n == 0) {
            document.getElementById("prevBtn").style.display = "none";
        } else {
            document.getElementById("prevBtn").style.display = "inline";
        }
        if (n == (x.length - 1)) {
            document.getElementById("nextBtn").innerHTML = "Submit";
        } else {
            document.getElementById("nextBtn").innerHTML = "Next";
        }
        // ... and run a function that displays the correct step indicator:
        fixStepIndicator(n)
    }

    function nextPrev(n) {
        console.log("nextPrev");

        console.log(n);
        // This function will figure out which tab to display
        var x = document.getElementsByClassName("tab");
        // Exit the function if any field in the current tab is invalid:
        if (n == 1 && !validateForm()) return false;
        // Hide the current tab:
        x[currentTab].style.display = "none";
        // Increase or decrease the current tab by 1:
        currentTab = currentTab + n;
        // if you have reached the end of the form... :
        if (currentTab >= x.length) {
            //...the form gets submitted:
            document.getElementById("regForm").submit();
            return false;
        }
        // Otherwise, display the correct tab:
        showTab(currentTab);
    }

    function validateForm() {
        console.log("validateForm");

        // This function deals with validation of the form fields
        var x, y, i, valid = true;
        x = document.getElementsByClassName("tab");
        y = x[currentTab].getElementsByTagName("input");
        console.log("number of inputs" + y.length);
        // A loop that checks every input field in the current tab:
        var num = 1;
        for (i = 0; i < y.length; i++) {
            // If a field is empty...
            if (y[i].value == "") {
                // add an "invalid" class to the field:
                x = document.getElementById('input' + num);
                x.innerText = "ce champ est requis!";
                x.style.display = "inline";
                y[i].className += " invalid";
                // and set the current valid status to false:
                valid = false;
                num++;
            }
        }
        // If the valid status is true, mark the step as finished and valid:
        if (valid) {
            document.getElementsByClassName("step")[currentTab].className += " primary";
        }
        return valid; // return the valid status
    }

    function fixStepIndicator(n) {
        console.log("fixStepIndicator");
        console.log(n);

        // This function removes the "active" class of all steps...
        var i, x = document.getElementsByClassName("step");
        for (i = 0; i < x.length; i++) {
            x[i].className = x[i].className.replace(" active", "");
        }
        //... and adds the "active" class to the current step:
        x[n].className += " active";
    }

</script>

<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>